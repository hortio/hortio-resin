<!doctype HTML>
<html>
<script src="vendor/aframe.min.js"></script>
<script src="vendor/aframe-ar.js"></script>
<script>
  const apiUrl = 'http://192.168.0.101/state.json'

  // Public API url: 'https://0df65f4d56c4166b4ebc9fa4d6f7ce67.resindevice.io/state.json';

  document.addEventListener("DOMContentLoaded", function (event) {
    const updateData = () => {
      fetch(apiUrl)
        .then(function (response) {
          return response.json();
        })
        .then(function (data) {
          // Day of cycle
          const dayOfCycle = data.cycle.day;
          const daysOfCycle = document.querySelectorAll(".day-of-cycle");
          daysOfCycle.forEach((d) => { d.setAttribute("value", dayOfCycle) });

          // Phase description
          const phaseDescriptions = document.querySelectorAll(".phase-description");
          let phaseImageId = "#p4";

          if (dayOfCycle < 4) {
            phaseImageId = "#p1"
          } else if (dayOfCycle < 10) {
            phaseImageId = "#p2"
          } else if (dayOfCycle < 19) {
            phaseImageId = "#p3"
          } else {
            phaseImageId = "#p4"
          }

          phaseDescriptions.forEach((phaseDescription) => { phaseDescription.setAttribute("src", phaseImageId) });

          // Sensors
          const sensors = {
            "l1-h": "%",
            "l1-t": "째C",
            "l0-h": "%",
            "l0-t": "째C",
            "solution-ec": "mS/cm",
            "solution-ph": ""
          }

          for (var sensor in sensors) {
            if (sensors.hasOwnProperty(sensor)) {
              let unit = sensors[sensor];
              console.log(unit);
              const sensorElements = document.querySelectorAll("." + sensor);
              sensorElements.forEach((s) => { s.setAttribute("value", data.sensors[sensor].value + unit) });
            }
          }
        });
    }

    updateData();

    setInterval(updateData, 600000);
  });

</script>

<body style='margin : 0px; overflow: hidden;'>
  <a-scene arjs='debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3_PARITY65;' vr-mode-ui="enabled: false">
    <!-- Assets  -->
    <a-assets>
      <img id="p1" src="images/p1.png">
      <img id="p2" src="images/p2.png">
      <img id="p3" src="images/p3.png">
      <img id="p4" src="images/p4.png">
      <img id="top" src="images/top.png">
      <img id="bottom" src="images/bottom.png">
    </a-assets>

    <!-- Level 0, Top -->
    <a-marker type='barcode' value='1' size="0.033">
      <a-image position="5 0 -3" rotation="-90 0 0" width="14" height="7" src="#top">
        <a-image class="phase-description" position="3 1.2 0.4" width="4" height="0.35" src="#p4"></a-image>
        <a-text class="day-of-cycle" width="1.8" wrap-count="9" align="right" position="-4.7 1.18 0.4" value="0" color="#111"
          transparent="false" alpha-test="1"></a-text>
        <a-text class="l0-t" width="1.8" wrap-count="9" align="left" position="-1.3 -0.5 0.4" value="0째C" color="#111"
          transparent="false" alpha-test="1"></a-text>
        <a-text class="l0-h" width="1.8" wrap-count="9" align="left" position="-1.3 -1 0.4" value="0%" color="#111"
          transparent="false" alpha-test="1"></a-text>
        <a-text class="solution-ph" width="1.8" wrap-count="9" align="left" position="-1.3 -2.6 0.4" value="0" color="#111"
          transparent="false" alpha-test="1"></a-text>
        <a-text class="solution-ec" width="1.8" wrap-count="9" align="left" position="-1.3 -3 0.4" value="0mS/cm" color="#111"
          transparent="false" alpha-test="1"></a-text>
      </a-image>
    </a-marker>

    <a-marker type='barcode' value='5'>
      <a-image position="-3.8 0 -3" rotation="-90 0 0" width="14" height="7" src="#bottom">
        <a-image class="phase-description" position="3 1.2 0.4" width="4" height="0.35" src="#p4"></a-image>
        <a-text class="day-of-cycle" width="1.8" wrap-count="9" align="right" position="-4.7 1.18 0.4" value="0" color="#111"
          transparent="false" alpha-test="1"></a-text>
        <a-text class="l1-t" width="1.8" wrap-count="9" align="left" position="-1.3 -0.5 0.4" value="0째C" color="#111"
          transparent="false" alpha-test="1"></a-text>
        <a-text class="l1-h" width="1.8" wrap-count="9" align="left" position="-1.3 -1 0.4" value="0%" color="#111"
          transparent="false" alpha-test="1"></a-text>
        <a-text class="solution-ph" width="1.8" wrap-count="9" align="left" position="-1.3 -2.6 0.4" value="0" color="#111"
          transparent="false" alpha-test="1"></a-text>
        <a-text class="solution-ec" width="1.8" wrap-count="9" align="left" position="-1.3 -3 0.4" value="0mS/cm" color="#111"
          transparent="false" alpha-test="1"></a-text>
      </a-image>
    </a-marker>
  </a-scene>
</body>
<a-entity camera></a-entity>

</html>